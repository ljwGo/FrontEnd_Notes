[toc]
React 的渲染过程确实分为两个主要阶段：**渲染阶段（Render Phase）** 和 **提交阶段（Commit Phase）**。这两个阶段共同构成了 React 的更新流程，但它们的职责和执行顺序有所不同。

------

### 1. **渲染阶段（Render Phase）**

- **目的**：生成新的虚拟 DOM 树（React Element Tree），并与旧的树进行对比（Diffing），找出需要更新的部分。
- **执行顺序**：**从上到下（父组件 → 子组件）**。
  - React 从根组件开始，递归调用组件的 `render` 方法（函数组件直接执行函数体），生成新的虚拟 DOM 树。
  - 对于类组件，会调用 `render()` 方法；对于函数组件，直接执行函数体。
  - 如果组件内部有状态或属性变化，会触发子组件的重新渲染。
- **特点**：
  - **可中断**：React 的 Fiber 架构允许渲染阶段被中断，优先处理高优先级任务（如用户交互），避免阻塞主线程。
  - **调和（Reconciliation）**：通过 Diff 算法比较新旧虚拟 DOM，生成待更新的操作列表（副作用列表）。

------

### 2. **提交阶段（Commit Phase）**

- **目的**：将渲染阶段计算出的变更应用到真实 DOM 上，并执行相关的生命周期方法或 Effect。
- **执行顺序**：
  - **DOM 更新顺序**：从根节点到叶子节点（整体更新一次性完成）。
  - **生命周期/Effect 执行顺序**：
    - **提交阶段前**：执行 `getSnapshotBeforeUpdate`（类组件）。
    - **DOM 更新后**：执行 `componentDidMount`、`componentDidUpdate`（类组件），或 `useLayoutEffect`（函数组件）。
    - **浏览器绘制后**：执行 `useEffect`（函数组件）。
    - **子组件 → 父组件**：例如，子组件的 `useEffect` 会比父组件先执行。
- **特点**：
  - **同步不可中断**：提交阶段必须一次性完成，确保 DOM 的一致性。
  - **副作用执行**：包括 DOM 更新、Effect 回调、生命周期方法等。

------

### React 18+ 的并发模式

在 React 18 引入的并发模式（Concurrent Mode）中，渲染阶段的行为可能更复杂：

- **可中断的渲染**：React 可以暂停低优先级渲染，优先处理用户输入等高优先级任务。
- **自动批处理**：多个状态更新可能被合并到一次渲染中。

------

